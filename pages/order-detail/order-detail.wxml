<!--pages/order-detail/order-detail.wxml-->
<view class="w-screen h-screen bg-gray-100">
  <!-- 顶部导航栏 -->
  <view class="flex items-center justify-between px-5 py-3 bg-white border-b border-gray-200">
    <view class="flex items-center" bindtap="handleBack">
      <t-icon name="chevron-left" size="40rpx" class="text-gray-600" />
      <text class="ml-2 text-base">返回</text>
    </view>
    <text class="text-lg font-bold">订单详情</text>
    <view class="w-16"></view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="flex justify-center items-center h-screen">
    <t-loading theme="circular" size="40rpx" />
  </view>

  <!-- 订单详情内容 -->
  <view wx:else class="px-5 py-5">
    <!-- 订单状态 -->
    <view class="bg-white rounded-lg p-5 mb-5">
      <view class="flex justify-between items-center">
        <text class="text-lg font-bold">订单号：{{orderDetail.orderId}}</text>
        <text class="text-base {{orderDetail.status === 'SUCCESS' ? 'text-green-500' : orderDetail.status === 'REFUND' ? 'text-red-500' : 'text-orange-500'}}">
          {{orderDetail.status === 'SUCCESS' ? '支付成功' : orderDetail.status === 'REFUND' ? '已退款' : orderDetail.status === 'NOTPAY' ? '未支付' : orderDetail.status}}
        </text>
      </view>
      <view class="mt-3 text-sm text-gray-500">
        <text>下单时间：{{orderDetail.formattedTime}}</text>
      </view>
    </view>

    <!-- 取餐信息 -->
    <view wx:if="{{orderDetail.status === 'SUCCESS'}}" class="bg-white rounded-lg p-5 mb-5">
      <view class="flex items-center justify-between px-3 py-2 bg-gray-100 rounded-lg">
        <view class="flex items-center">
          <text class="text-xs">取餐号</text>
          <text class="text-2xl ml-3 font-bold">{{orderDetail.id}}</text>
        </view>
        <view class="flex items-center">
          <text class="text-xs text-gray-500">{{orderDetail.description}}</text>
          <t-icon name="copy" class="text-gray-600 ml-2" size="24rpx" />
        </view>
      </view>
    </view>

    <!-- 商品列表 -->
    <view class="bg-white rounded-lg p-5 mb-5">
      <text class="text-lg font-bold mb-3 block">商品清单</text>
      <view class="border-0 border-t border-solid border-gray-200 pt-3">
        <view class="flex justify-between items-center py-3" wx:for="{{orderDetail.products}}" wx:key="*this">
          <view class="flex items-center">
            <image src="{{item.image || '/static/images/b.jpg'}}" mode="aspectFill" class="w-16 h-16 rounded-lg" />
            <view class="ml-3">
              <text class="text-base">{{item.name}}</text>
              <view class="mt-1 text-xs text-gray-500">
                <text>{{item.aa1}}</text>
                <text wx:if="{{item.aa2}}" class="ml-2">{{item.aa2}}</text>
              </view>
            </view>
          </view>
          <view class="text-right">
            <text class="text-sm text-gray-500">x{{item.quantity}}</text>
            <view class="mt-1 text-base font-bold">￥{{item.price}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 订单金额 -->
    <view class="bg-white rounded-lg p-5 mb-5">
      <view class="flex justify-between items-center py-2">
        <text class="text-sm text-gray-500">商品总额</text>
        <text class="text-sm">￥{{orderDetail.amount}}</text>
      </view>
      <view class="flex justify-between items-center py-2 border-0 border-t border-solid border-gray-100">
        <text class="text-lg font-bold">实付金额</text>
        <text class="text-lg font-bold text-red-500">￥{{orderDetail.amount}}</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view wx:if="{{orderDetail.status === 'SUCCESS'}}" class="flex justify-center mt-10">
      <view class="w-80 h-12 flex items-center justify-center bg-red-500 text-white rounded-full" bindtap="handleRefund">
        申请退款
      </view>
    </view>
  </view>
</view>